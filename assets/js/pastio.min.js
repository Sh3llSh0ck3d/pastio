/**
 * Pastio
 * http://www.cixtor.com/
 * https://github.com/cixtor/pastio
 *
 * Multi-platform desktop application built on top of node-webkit, node.js and a
 * public webservice maintained by cixtor.com to paste and visualize text/plain
 * files like source code, markdown files, plain text documents and publish them
 * public or privately for an unlimited time in a remote database and share those
 * files using a unique link identifier.
 */

// Load native UI library
var gui = require('nw.gui'),
    win = gui.Window.get();

// Exit submenu
var exit = new gui.MenuItem({
    label: "Exit",
    click: function(){
        win.close();
    }
});

// About submenu
var about = new gui.MenuItem({
    label: "About",
    click: function(){
        alert("Node Webkit Demo App");
    }
})

// Create an empty menu
var menu = new gui.Menu({type: 'menubar'}),
    submenu = new gui.Menu();
submenu_help = new gui.Menu()

submenu.append(exit);
submenu_help.append(about);

var file = menu.append(new gui.MenuItem({ label: 'File', submenu: submenu})),
    help = menu.append(new gui.MenuItem({ label: 'Help', submenu: submenu_help }));

win.menu = menu;

win.on('close', function(){
    this.hide();
    console.log('Closing app...');
    this.close(true);
});

/**
 * Drag & Drop functionality
 * https://github.com/rogerwang/node-webkit/wiki/Dragging-files-into-page
 */

// Prevent default behavior from changing page on dropped file.
window.ondragover = function(e){ e.preventDefault(); return false };
window.ondrop = function(e){ e.preventDefault(); return false };

var holder = document.getElementById('pastioform');
holder.ondragover = function(){ this.className = 'hover'; return false; };
holder.ondragend = function(){ this.className = ''; return false; };
holder.ondrop = function(e){
    e.preventDefault();
    for( var i=0; i<e.dataTransfer.files.length; ++i ){
        console.log(e.dataTransfer.files[i].path);
    }
    return false;
};
