/**
 * Pastio
 * http://www.cixtor.com/
 * https://github.com/cixtor/pastio
 *
 * Multi-platform desktop application built on top of node-webkit, node.js and a
 * public webservice maintained by cixtor.com to paste and visualize text/plain
 * files like source code, markdown files, plain text documents and publish them
 * public or privately for an unlimited time in a remote database and share those
 * files using a unique link identifier.
 */

(function(){
    var Pastio = {
        appconfig: require('./package.json'),
        gui: require('nw.gui'),
        editor: false,

        get_window: function(){
            return this.gui.Window.get();
        },

        load_interface: function(){
            var gui = this.gui;
            var win = this.get_window();
            var instance = this;

            // Native menu application.
            var menu = new gui.Menu({type: 'menubar'})
                , submenu_file = new gui.Menu()
                , submenu_help = new gui.Menu();

            var file = menu.append(new gui.MenuItem({ label: 'File', submenu: submenu_file }));
            var help = menu.append(new gui.MenuItem({ label: 'Help', submenu: submenu_help }));

            submenu_file.append( new gui.MenuItem({ label: 'New', click: function(){ instance.reset_editor() } }) );
            submenu_file.append( new gui.MenuItem({ label: 'Exit', click: function(){ win.close() }}) );
            submenu_help.append( new gui.MenuItem({ label: 'About', click: function(){ alert('Node Webkit Demo App') }}) );

            win.menu = menu;

            win.on('close', function(){
                this.hide();
                console.log('Closing app...');
                this.close(true);
            });
        },

        initialize_editor: function(){
            this.editor = ace.edit('pastioeditor');
            this.editor.setTheme('ace/theme/monokai');
            this.editor.getSession().setMode('ace/mode/javascript');
        },

        get_editor_content: function(){
            return this.editor.getValue();
        },

        reset_editor: function(){
            this.editor.setValue('');
        }
    };

    Pastio.load_interface();
    Pastio.initialize_editor();
})();
